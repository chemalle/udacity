{% load static %}



<form action="{% url 'udacity' %}">
    <input type="submit"  value="Analise seus ativos" >
</form>


<img class="mb-4" src="{% static "images/forecast.jpg" %}" height="200">


<head>
<style>
body {
    background-color: blue;
}
h1 {
    background-color: blue;
}

}
</style>
</head>
<body>
<html>


<body>


<head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c4"><p class="c2"><span class="c3">C&Oacute;DIGO para prever a compra de a&ccedil;&otilde;es</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0"># utilizei o Yahoo como fonte de dados ao inv&eacute;s do Quandl por se tratar de uma biblioteca gratuita sem limita&ccedil;&otilde;es de ativos pass&iacute;veis de an&aacute;lise.</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">def UDACITY(form):</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; try:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; ticker = form.ticker+&#39;.sa&#39;</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; stocks = [&#39;QQQ&#39;,&#39;EWZ&#39;,&#39;VXX&#39;,&#39;GLD&#39;,&#39;^BVSP&#39;,ticker]</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization = web.DataReader(stocks, data_source=&#39;yahoo&#39;)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization.fillna(method=&#39;bfill&#39;, inplace=True)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization = optimization.to_frame(filter_observations=True)[&#39;Close&#39;].reset_index()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization.rename(columns={&#39;minor&#39;: &#39;Ticker&#39;,</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;Adj Close&#39;: &#39;Close&#39;}, inplace=True)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization = optimization.pivot(index=&#39;Date&#39;, columns=&#39;Ticker&#39;)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization.columns = optimization.columns.droplevel(0)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; # pivot each ticker to a column</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X, y = [], []</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; for index,row in optimization.iterrows():</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X.append(row[0:-1])</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y.append(row[-1])</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X, y = shuffle(X, y, random_state=23)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; num_training = int(0.9 * len(X))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X_train, y_train = X[:num_training], y[:num_training]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X_test, y_test = X[num_training:], y[num_training:]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; rf_regressor = RandomForestRegressor(n_estimators=1000, &nbsp; &nbsp; &nbsp;max_depth=10,random_state=23)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; rf_regressor.fit(X_train, y_train)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; y_pred = rf_regressor.predict(X_test)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; adaboost_pred = rf_regressor.predict(optimization.iloc[:,0:-1])</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; adaboost_pred = adaboost_pred.reshape(-1,1)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization[&#39;Prediction&#39;] = adaboost_pred</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; mse = mean_squared_error(optimization[&#39;Prediction&#39;], optimization.iloc[:,-2])</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; evs = explained_variance_score(optimization[&#39;Prediction&#39;], optimization.iloc[:,-2])</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization[&#39;MSE&#39;]= mse</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; optimization[&#39;EVS&#39;] = evs</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX = optimization</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SMA3&#39;] = pd.Series.rolling(SPX[&#39;Prediction&#39;], 3).mean()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SMA8&#39;] = pd.Series.rolling(SPX[&#39;Prediction&#39;], 8).mean()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SMA21&#39;] = pd.Series.rolling(SPX[&#39;Prediction&#39;], 21).mean()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SMA50&#39;] = pd.Series.rolling(SPX[&#39;Prediction&#39;], 50).mean()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SMA200&#39;] = pd.Series.rolling(SPX[&#39;Prediction&#39;], 200).mean()</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX.dropna(inplace=True)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; </span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; DayTrading = SPX[&#39;SMA3&#39;] - SPX[&#39;SMA21&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;DayTrading&#39;] = DayTrading</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;SwingTrade&#39;] = np.where(SPX[&#39;DayTrading&#39;]&gt;0, 1,-1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;GOLDEN_SMA3&#39;] = SPX[&#39;SwingTrade&#39;].shift(+1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;position3&#39;] = np.where(SPX[&#39;SMA3&#39;] &gt; SPX[&#39;SMA21&#39;], 1, -1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;position8&#39;] = np.where(SPX[&#39;SMA8&#39;] &gt; SPX[&#39;SMA21&#39;], 1, -1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; Recomenda = SPX[&#39;SMA50&#39;] - SPX[&#39;SMA200&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;Recomenda&#39;] = Recomenda</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;GOLDEN&#39;] = np.where(SPX[&#39;Recomenda&#39;]&gt;0, 1,-1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;GOLDEN_CROSS&#39;] = SPX[&#39;GOLDEN&#39;].shift(+1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;position&#39;] = np.where(SPX[&#39;SMA3&#39;] &gt; SPX[&#39;SMA21&#39;], 1, -1)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;market&#39;] = np.log(SPX[ticker] / SPX[ticker].shift(1))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; # vectorized calculation of strategy returns</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;strategy&#39;] = SPX[&#39;position&#39;].shift(1) * SPX[&#39;market&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; Golden_Rule = SPX[&#39;strategy&#39;] - SPX[&#39;market&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; SPX[&#39;GOLDEN_RULE&#39;] = Golden_Rule</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if SPX[&#39;GOLDEN_SMA3&#39;][-1] == -1 and SPX[&#39;SwingTrade&#39;][-1] == 1:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker,SPX[&#39;SMA21&#39;][-1], &#39;SMA3 just REACHED!&#39;, SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; elif SPX[&#39;position3&#39;][-1] == 1:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker, SPX[&#39;SMA21&#39;][-1], &#39;SMA3&#39;,SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; elif SPX[&#39;position8&#39;][-1] == 1:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker,SPX[&#39;SMA21&#39;][-1], &#39;SMA8&#39;,SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; elif SPX[&#39;GOLDEN_CROSS&#39;][-1] == -1 and SPX[&#39;GOLDEN&#39;][-1] == 1:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker,SPX[&#39;SMA200&#39;][-1], &#39;Golden_Cross REACHED!&#39;,SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; elif SPX[&#39;GOLDEN&#39;][-1] == 1:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker,SPX[&#39;SMA200&#39;][-1], &#39;Long Term&#39;,SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; else:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; average = [[ticker,SPX[&#39;SMA200&#39;][-1], &#39;downward trend&#39;,SPX[&#39;GOLDEN_RULE&#39;][-1],optimization[&#39;MSE&#39;][-1],optimization[&#39;EVS&#39;][-1], &#39;Random Forest&#39;]]</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; barchart = pd.DataFrame(list(average))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; barchart = barchart</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; barchart.columns = [&#39;Ticker&#39;, &#39;SMA&#39;,&#39;ACTION&#39;,&#39;Strategy Vs Market&#39;,&#39;MSE&#39;,&#39;EVS&#39;,&#39;Method&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; barchart2 = barchart.to_html(index=False,columns=[&#39;Ticker&#39;, &#39;SMA&#39;,&#39;ACTION&#39;,&#39;Strategy Vs Market&#39;,&#39;MSE&#39;,&#39;EVS&#39;,&#39;Method&#39;])</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; EVS = &nbsp;&quot;{0:.2f}%&quot;.format(float(barchart[&#39;EVS&#39;][0]*100))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; MSE = &nbsp;&#39;{:,.2f}&#39;.format(float(barchart[&#39;MSE&#39;][0]))</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; except Exception:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return render_to_response(&#39;project/apologies.html&#39;)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; return render_to_response(&#39;name.html&#39;, context= {&#39;barchart&#39;:barchart2,&#39;EVS&#39;:EVS, &#39;MSE&#39;: MSE})</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><img class="mb-4" src="{% static "images/image1.png" %}"><p class="c2"><span class="c3">C&Oacute;DIGO para classificar a&ccedil;&otilde;es em clusters</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">from sklearn import covariance</span></p><p class="c2"><span class="c0">from pandas_datareader import data as web</span></p><p class="c2"><span class="c0">import numpy as np</span></p><p class="c2"><span class="c0">def kluster(form):</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; try:</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; tickerA = web.DataReader(form.tickerA+&#39;.sa&#39;,data_source=&#39;yahoo&#39;)[-252:]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; tickerB = web.DataReader(form.tickerB+&#39;.sa&#39;,data_source=&#39;yahoo&#39;)[-252:]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; tickerC = web.DataReader(form.tickerC+&#39;.sa&#39;,data_source=&#39;yahoo&#39;)[-252:]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; tickerD = web.DataReader(form.tickerD+&#39;.sa&#39;,data_source=&#39;yahoo&#39;)[-252:]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; tickerE = web.DataReader(form.tickerE+&#39;.sa&#39;,data_source=&#39;yahoo&#39;)[-252:]</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; barchart = [tickerA,tickerB,tickerC,tickerD,tickerE]</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; names = [form.tickerA,form.tickerB,form.tickerC,form.tickerD,form.tickerE]</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; quotes = []</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; for item in barchart:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; portfolio = pd.DataFrame(item)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; quotes.append(portfolio)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; names = pd.DataFrame(names).T</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; opening_quotes = np.array([quote.Open for quote in quotes]).astype(np.float)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; closing_quotes = np.array([quote.Close for quote in quotes]).astype(np.float)</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; delta_quotes = closing_quotes - opening_quotes</span></p><p class="c1"><span class="c0"></span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; edge_model = covariance.GraphLassoCV()</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X = delta_quotes.copy().T</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; X /= X.std(axis=0)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; with np.errstate(invalid=&#39;ignore&#39;):</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; edge_model.fit(X)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; from sklearn import cluster</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; _, labels = cluster.affinity_propagation(edge_model.covariance_)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; num_labels = labels.max()</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; k = []</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; for i in range(num_labels + 1):</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; try:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cluster= ( i+1, &#39;, &#39;.join(names.T[0][labels == i]))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; k.append(cluster)</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; except Exception:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pass &nbsp;# or you could use &#39;continue&#39;</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; kluster = pd.DataFrame(list(k))</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; kluster.columns = [&#39;Cluster&#39;,&#39;Ticker&#39;]</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; kluster = kluster.to_html(index=False,columns=[&#39;Cluster&#39;, &#39;Ticker&#39;])</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; except Exception:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return render_to_response(&#39;project/apologies.html&#39;)</span></p><p class="c1"><span class="c0"></span></p><p class="c2"><span class="c0">&nbsp; &nbsp; return render_to_response(&#39;cluster.html&#39;, context= {&#39;kluster&#39;:kluster})</span></p><p class="c1"><span class="c0"></span></p></body>


  <form action="{% url 'udacity2' %}">
      <input type="submit" value="Vamos analisar uma carteira?" />
  </form></body></html>
